(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{FillInBlanks:()=>y,MultipleChoices:()=>w,QuestionBase:()=>u,SingleChoice:()=>d,TrueOrFalse:()=>m,default:()=>f});const s=window.React,r=window.wp.element,n=window.wp.compose,i=window.wp.data,o=window.wp.i18n,{isArray:a,get:p,set:l}=lodash;class c extends r.Component{constructor(e){super(...arguments);const{question:t}=e;this.state={optionClass:["answer-option"],questionId:0,options:t?this.parseOptions(t.options):[],self:this},e.$wrap&&(this.$wrap=e.$wrap)}static getDerivedStateFromProps(e,t){return t.self.prepare(e,t)}componentDidMount(){const e=this.prepare(this.props,this.state);e&&this.setState(e)}prepare=(e,t)=>{const{question:s}=e;return s&&s.id!==t.questionId?{options:t.self.parseOptions(s.options)}:null};setInputRef=(e,t)=>{this.inputs||(this.inputs={}),this.inputs[t]=e};maybeShowCorrectAnswer=()=>{const{status:e,isCheckedAnswer:t,showCorrectReview:s,isReviewing:r}=this.props;return"completed"===e&&s||t&&!r};maybeDisabledOption=e=>{const{answered:t,status:s,isCheckedAnswer:r}=this.props;return r||"started"!==s};setAnswerChecked=()=>e=>{const{updateUserQuestionAnswers:t,question:s,status:r}=this.props;if("started"!==r)return(0,o.__)("LP Error: can not set answers","learnpress");const n=this.$wrap.find(".option-check"),i=[],a="multi_choice"!==s.type;n.each(((e,t)=>{if(t.checked&&(i.push(t.value),a))return!1})),t(s.id,a?i[0]:i)};maybeCheckedAnswer=e=>{const{answered:t}=this.props;return a(t)?!!t.find((t=>t==e)):e==t};getOptionType=(e,t)=>{let s="radio";return"multi_choice"===e&&(s="checkbox"),s};isDefaultType=()=>this.props.supportOptions;getWarningMessage=()=>(0,s.createElement)(s.Fragment,null,(0,o.__)("The render function should be overwritten from the base.","learnpress"));getOptionClass=e=>{const{answered:t}=this.props;return["answer-option"]};parseOptions=e=>(e&&(e=a(e)?e:JSON.parse(CryptoJS.AES.decrypt(e.data,e.key,{format:CryptoJSAesJson}).toString(CryptoJS.enc.Utf8)),e=a(e)?e:JSON.parse(e)),e||[]);getOptions=()=>this.state.options||[];isCorrect=()=>{const{answered:e}=this.props;if(!e)return!1;let t,s,r;for(t=0,r=this.getOptions();t<r.length;t++)if(s=r[t],"yes"===s.isTrue&&e==s.value)return!0;return!1};isChecked=()=>{const{question:e}=this.props;return(0,i.select)("learnpress/quiz").isCheckedAnswer(e.id)};getCorrectLabel=()=>{const{status:e,answered:t,question:r}=this.props,n=(LP.config.isQuestionCorrect[r.type]||this.isCorrect).call(this);return this.maybeShowCorrectAnswer()&&(0,s.createElement)("div",{className:"question-response"+(n?" correct":" incorrect")},(0,s.createElement)("span",{className:"label"},n?(0,o.__)("Correct","learnpress"):(0,o.__)("Incorrect","learnpress")),(0,s.createElement)("span",{className:"point"},sprintf((0,o.__)("%d/%d point","learnpress"),n?r.point:0,r.point)))};render(){const{question:e,status:t}=this.props;return(0,s.createElement)("div",{className:"question-answers"},this.isDefaultType()&&(0,s.createElement)("ul",{id:`answer-options-${e.id}`,className:"answer-options"},this.getOptions().map((r=>{const n=`learn-press-answer-option-${r.uid}`;return(0,s.createElement)("li",{className:this.getOptionClass(r).join(" "),key:`answer-option-${r.uid}`},(0,s.createElement)("input",{type:this.getOptionType(e.type,r),className:"option-check",name:"started"===t?`learn-press-question-${e.id}`:"",id:n,ref:e=>{this.setInputRef(e,r.value)},onChange:this.setAnswerChecked(),disabled:this.maybeDisabledOption(r),checked:this.maybeCheckedAnswer(r.value),value:"started"===t?r.value:""}),(0,s.createElement)("label",{htmlFor:n,className:"option-title",dangerouslySetInnerHTML:{__html:r.title||r.value}}))}))),!this.isDefaultType()&&this.getWarningMessage(),this.getCorrectLabel())}}const u=c,d=class extends u{getOptionClass=e=>{const{answered:t}=this.props,s=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&s.push("answer-correct"),t&&("yes"===e.isTrue?t===e.value&&s.push("answered-correct"):t===e.value&&s.push("answered-wrong"))),s}},{isBoolean:h}=lodash,w=class extends u{isCorrect=()=>{const{answered:e}=this.props;if(h(e)||!e)return!1;let t,s,r;for(t=0,r=this.getOptions();t<r.length;t++)if(s=r[t],"yes"===s.isTrue){if(-1===e.indexOf(s.value))return!1}else if(-1!==e.indexOf(s.value))return!1;return!0};getOptionClass=e=>{const{answered:t}=this.props,s=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&s.push("answer-correct"),t&&("yes"===e.isTrue?-1!==t.indexOf(e.value)&&s.push("answered-correct"):-1!==t.indexOf(e.value)&&s.push("answered-wrong"))),s}},m=class extends u{getOptionClass=e=>{const{answered:t}=this.props,s=[...this.state.optionClass];return this.maybeShowCorrectAnswer()&&("yes"===e.isTrue&&s.push("answer-correct"),t&&("yes"===e.isTrue?t===e.value&&s.push("answered-correct"):t===e.value&&s.push("answered-wrong"))),s}},y=class extends u{componentDidMount(){const{answered:e}=this.props;e&&[...document.querySelectorAll(".lp-fib-input > input")].map((t=>{e[t.dataset.id]&&(t.value=e[t.dataset.id])})),this.updateFibAnswer()}componentDidUpdate(e){e.answered||this.updateFibAnswer()}updateFibAnswer=()=>{const e=document.querySelectorAll(".lp-fib-input > input"),{answered:t}=this.props,s=t||{};[...e].map((e=>{void 0===t&&(e.value=""),e.addEventListener("input",(t=>{this.setAnswered(s,e.dataset.id,t.target.value)})),e.addEventListener("paste",(t=>{this.setAnswered(s,e.dataset.id,t.target.value)}))}))};setAnswered=(e,t,s)=>{const{updateUserQuestionAnswers:r,question:n,status:i}=this.props;if("started"!==i)return"LP Error: can not set answers";const o=Object.assign(e,{[t]:s});r(n.id,o)};getCorrectLabel=()=>{const{question:e,mark:t}=this.props;let r=t||0;return t&&(Number.isInteger(t)||(r=t.toFixed(2))),this.maybeShowCorrectAnswer()&&(0,s.createElement)("div",{className:"question-response correct"},(0,s.createElement)("span",{className:"label"},(0,o.__)("Points","learnpress")),(0,s.createElement)("span",{className:"point"},`${r}/${e.point} ${(0,o.__)("point","learnpress")}`),(0,s.createElement)("span",{className:"lp-fib-note"},(0,s.createElement)("span",{style:{background:"#00adff"}}),(0,o.__)("Correct","learnpress")),(0,s.createElement)("span",{className:"lp-fib-note"},(0,s.createElement)("span",{style:{background:"#d85554"}}),(0,o.__)("Incorrect","learnpress")))};convertInputField=e=>{const{answered:t,isReviewing:s,showCorrectReview:r,isCheckedAnswer:n}=this.props;let i=e.title;const o=e?.answers;return e.ids.map(((e,a)=>{const p="{{FIB_"+e+"}}";let l="";const c=o?o?.[e]:void 0;var u,d;c||s?(l+=`<span class="lp-fib-answered ${(r||n)&&c?.correct?c?.isCorrect?"correct":"fail":""}">`,c?.isCorrect||(l+=`<span class="lp-fib-answered__answer">${null!==(d=t?.[e])&&void 0!==d?d:""}</span>`),!c?.isCorrect&&c?.correct&&(l+=" â†’ "),l+=`<span class="lp-fib-answered__fill">${null!==(u=c?.correct)&&void 0!==u?u:""}</span>`,l+="</span>"):(l+='<div class="lp-fib-input" style="display: inline-block; width: auto;">',l+='<input type="text" data-id="'+e+'" value="" />',l+="</div>");i=i.replace(p,l)})),i};render(){return(0,s.createElement)(s.Fragment,null,(0,s.createElement)("div",{className:"lp-fib-content"},this.getOptions().map((e=>(0,s.createElement)("div",{key:`blank-${e.uid}`,dangerouslySetInnerHTML:{__html:this.convertInputField(e)||e.value}})))),!this.isDefaultType()&&this.getWarningMessage(),this.getCorrectLabel())}};class g extends r.Component{getQuestion=()=>{const{question:e}=this.props;return LP.Hook.applyFilters("question-types",{single_choice:LP.questionTypes.SingleChoice,multi_choice:LP.questionTypes.MultipleChoices,true_or_false:LP.questionTypes.TrueOrFalse,fill_in_blanks:LP.questionTypes.FillInBlanks})[e.type]};render(){const{question:e,supportOptions:t}=this.props,r={...this.props};r.supportOptions=-1!==t.indexOf(e.type);const n=this.getQuestion()||function(){return(0,s.createElement)("div",{className:"question-types",dangerouslySetInnerHTML:{__html:(0,o.sprintf)((0,o.__)("Question <code>%s</code> invalid!","learnpress"),e.type)}})};return(0,s.createElement)(s.Fragment,null,(0,s.createElement)(n,{...r}))}}const f=(0,n.compose)((0,i.withSelect)(((e,{question:{id:t}})=>{const{getData:s,isCheckedAnswer:r}=e("learnpress/quiz");return{supportOptions:s("supportOptions"),isCheckedAnswer:r(t),keyPressed:s("keyPressed"),showCorrectReview:s("showCorrectReview"),isReviewing:"reviewing"===s("mode")}})),(0,i.withDispatch)((()=>({}))))(g);(window.LP=window.LP||{}).questionTypes=t})();